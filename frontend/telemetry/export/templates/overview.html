<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ title }}</title>

  <!-- Master BioRow CSS -->
  <link rel="stylesheet" href="{{ css_path }}">
</head>

<body>

<!-- ============================================================
     PAGE 1 — OVERVIEW
============================================================ -->

<div class="pdf-header">
  <div class="pdf-title">
    RowReport — Session ID {{ boat_data.id }}
  </div>
  <div class="pdf-subtitle">
    Overview & session metadata
  </div>
</div>

<h3 class="divider-bar">Session Metadata</h3>

<table class="info-table">
  <tr>
    <td class="info-col">
      <strong>Title:</strong> {{ boat_data.title }}<br>
      <strong>Date:</strong> {{ boat_data.date }}<br>
      <strong>Zone:</strong> {{ boat_data.state }}<br>
      <strong>Sensors:</strong> {{ boat_data.seat_sensors }}
    </td>

    <td class="info-col">
      <strong>Rowers:</strong> {{ boat_data.seats }}<br>
      <strong>Strokes:</strong> {{ boat_data.tstrokes }}<br>
      <strong>Distance:</strong> {{ boat_data.distance }} m<br>
      <strong>Elapsed:</strong> {{ boat_data.timeelapsed }}
    </td>
  </tr>
</table>

<h3 class="divider-bar">Crew List</h3>

<table class="report-table">
  <thead>
    <tr>
      <th class="seat-col">Seat</th>
      <th class="rotate"><div>Side</div></th>
      <th class="name-col">Name</th>
      <th class="rotate"><div>User</div></th>
    </tr>
  </thead>

  <tbody>
    {% for rower in rowers %}
    <tr class="seat-{{ rower.telemetry.seat }}">
      <td>{{ rower.telemetry.seat }}</td>
      <td>{{ rower.telemetry.side }}</td>
      <td>{{ rower.telemetry.name }}</td>
      <td style="text-align:left;">
        {% if rower.user.user_id %}
          {{ rower.user.first_name }} {{ rower.user.last_name }}
          ({{ rower.user.email }})
        {% else %}
          Unassigned
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="pdf-footer">
  <strong>RowReport</strong> — Developed by Ben Loggie
</div>

<div class="page-break"></div>


<!-- ============================================================
     PAGE 2 — AVERAGE REPORT (BioRow Page)
============================================================ -->

<div class="pdf-header">
  <div class="pdf-title">
    RowReport — Average Crew Metrics
  </div>
  <div class="pdf-subtitle">
    Full session overview
  </div>
</div>

{% set rating = (boat_data.rating|sum)/(boat_data.rating|length) %}
{% set power  = (boat_data.averagepower|sum)/(boat_data.averagepower|length) %}
{% set dps    = (boat_data.distanceperstroke|sum)/(boat_data.distanceperstroke|length) %}
{% set mps    = (boat_data.meterspersecond|sum)/(boat_data.meterspersecond|length) %}

<p class="summary-line">
  Rate {{ rating|round(2) }} spm |
  Power {{ power|round(2) }} W |
  DPS {{ dps|round(2) }} m |
  Speed {{ mps|round(2) }} m/s
</p>

<h3 class="divider-bar">Stroke Angles & Rhythm</h3>

<table class="report-table">
  <thead>
    <tr>
      <th class="seat-col">Seat</th>
      <th class="name-col">Name</th>
      <th class="rotate"><div>Drive</div></th>
      <th class="rotate"><div>Recovery</div></th>
      <th class="rotate"><div>Min</div></th>
      <th class="rotate"><div>Max</div></th>
      <th class="rotate"><div>Arc</div></th>
    </tr>
  </thead>

  <tbody>
    {% for rower in rowers %}
    {% set d = rower.telemetry %}
    <tr class="seat-{{ d.seat }}">
      <td>{{ d.seat }}</td>
      <td>{{ d.name }}</td>
      <td>{{ ((d.drive_time|sum)/(d.drive_time|length))|round(2) }}</td>
      <td>{{ ((d.recovery_time|sum)/(d.recovery_time|length))|round(2) }}</td>
      <td>{{ ((d.min_angle|sum)/(d.min_angle|length))|round(2) }}</td>
      <td>{{ ((d.max_angle|sum)/(d.max_angle|length))|round(2) }}</td>
      <td>{{ ((d.arc_length|sum)/(d.arc_length|length))|round(2) }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h3 class="divider-bar">Graphs</h3>

<div class="graph-grid">
  <div class="graph-cell">
    <div class="panel">
      <img src="{{ graphs.syncronisation | safe }}">
    </div>
  </div>

  <div class="graph-cell">
    <div class="panel">
      <img src="{{ graphs.ratios | safe }}">
    </div>
  </div>
</div>

<div class="graph-grid">
  <div class="graph-cell">
    <div class="panel">
      <img src="{{ graphs.gateforcepercent | safe }}">
    </div>
  </div>

  <div class="graph-cell">
    <div class="panel">
      <img src="{{ graphs.gateforcex | safe }}">
    </div>
  </div>
</div>

<div class="pdf-footer">
  <strong>RowReport</strong> — Developed by Ben Loggie
</div>

<div class="page-break"></div>


<!-- ============================================================
     PAGE 3 — SAMPLE BREAKDOWN
============================================================ -->

<div class="pdf-header">
  <div class="pdf-title">
    RowReport — Sample Breakdown
  </div>
  <div class="pdf-subtitle">
    Session distribution (1–8)
  </div>
</div>

<h3 class="divider-bar">Sample Table</h3>

<table class="report-table">
  <thead>
    <tr>
      <th class="seat-col">Smp</th>
      <th class="rotate"><div>Rate</div></th>
      <th class="rotate"><div>Power</div></th>
      <th class="rotate"><div>DPS</div></th>
      <th class="rotate"><div>Speed</div></th>
    </tr>
  </thead>

  <tbody>
    {% for sample in range(0,8) %}
    <tr>
      <td>{{ sample+1 }}</td>
      <td>{{ boat_data.rating[sample] }}</td>
      <td>{{ boat_data.averagepower[sample] }}</td>
      <td>{{ boat_data.distanceperstroke[sample] }}</td>
      <td>{{ boat_data.meterspersecond[sample] }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h3 class="divider-bar">Graphs</h3>

<div class="graph-grid">
  <div class="graph-cell">
    <div class="panel">
      <img src="{{ graphs.power_timeline | safe }}">
    </div>
  </div>

  <div class="graph-cell">
    <div class="panel">
      <img src="{{ graphs.acceleration | safe }}">
    </div>
  </div>
</div>

<div class="graph-full">
  <img src="{{ graphs.rowing_speed | safe }}">
</div>

<div class="pdf-footer">
  <strong>RowReport</strong> — Developed by Ben Loggie
</div>

</body>
</html>
